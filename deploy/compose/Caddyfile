{$CADDY_ADDRESS} {
	encode zstd gzip

	# BetterAuth lives in the Next.js app (do not send to backend).
	@auth path /api/auth/*
	reverse_proxy @auth app:3000

	# Health checks remain direct to backend for operational probes.
	@health path /api/health
	reverse_proxy @health backend:8000

	# All other /api/* routes go through the Next.js proxy which signs
	# authenticated backend requests with internal headers.
	@api path /api/*
	reverse_proxy @api app:3000

	# Everything else goes to Next.js.
	reverse_proxy app:3000
}
